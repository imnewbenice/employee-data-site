<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee Data Dashboard</title>

  <!-- Chart.js for generating charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    .chart-container {
      width: 80%;
      margin: 40px auto;
    }
  </style>
</head>
<body>

  <h1>Employee Data Dashboard</h1>

  <!-- Bar Chart: Average Salary by Position over Years -->
  <div class="chart-container">
    <h2>Average Salary by Position over Years</h2>
    <canvas id="salaryBarChart"></canvas>
  </div>

  <!-- Pie Chart: Percentage of Staff by Position -->
  <div class="chart-container">
    <h2>Percentage of Staff by Position</h2>
    <canvas id="positionPieChart"></canvas>
  </div>

  <!-- Line Chart: Salary Growth Over Time -->
  <div class="chart-container">
    <h2>Salary Growth Over Time</h2>
    <canvas id="salaryGrowthChart"></canvas>
  </div>

  <script>
    $(document).ready(function () {
      // API URL to fetch Google Sheets data
      const url = 'https://sheets.googleapis.com/v4/spreadsheets/1Yn41lQl46YZBgeeD6V540UkB-z39TWniuJgyoGM8UwM/values/Data?key=AIzaSyDLEhcKsdLunc7FUSCSUd86uvTWI8f6Lpc';

      // Fetch the data from Google Sheets
      fetch(url)
        .then(response => response.json())
        .then(data => {
          const rows = data.values;  // Google Sheets data is under 'values' key

          // Store position-based data
          const positionSalaryData = {};
          const positionCount = {};
          const years = [];
          const positionGrowthData = {};

          // Loop through the data rows and extract relevant info
          for (let i = 1; i < rows.length; i++) {
            const row = rows[i];
            const position = row[2];  // Position column (third column)
            const year = row[5];  // Year column (sixth column)
            const salary = parseFloat(row[9]);  // Annual Salary column (tenth column)

            // Collect year data (if not already collected)
            if (!years.includes(year)) {
              years.push(year);
            }

            // Collect salary data by position for bar chart
            if (!positionSalaryData[position]) {
              positionSalaryData[position] = {};
              positionCount[position] = 0;
              positionGrowthData[position] = {};
            }

            // Store salary per year
            if (!positionSalaryData[position][year]) {
              positionSalaryData[position][year] = {
                totalSalary: 0,
                count: 0
              };
            }
            positionSalaryData[position][year].totalSalary += salary;
            positionSalaryData[position][year].count++;

            // Count number of employees per position for pie chart
            positionCount[position]++;
            
            // Collect data for salary growth chart
            if (!positionGrowthData[position][year]) {
              positionGrowthData[position][year] = 0;
            }
            positionGrowthData[position][year] += salary;
          }

          // Prepare data for the Bar Chart (Average Salary by Position over Years)
          const barChartLabels = years.sort();  // Sort years
          const barChartDatasets = [];
          for (let position in positionSalaryData) {
            const salaryAverages = barChartLabels.map(year => {
              if (positionSalaryData[position][year]) {
                return positionSalaryData[position][year].totalSalary / positionSalaryData[position][year].count;
              } else {
                return 0;
              }
            });
            barChartDatasets.push({
              label: position,
              data: salaryAverages,
              backgroundColor: getRandomColor(),
              borderColor: getRandomColor(),
              borderWidth: 1
            });
          }

          // Create the Bar Chart for Average Salary by Position over Years
          const ctx1 = document.getElementById('salaryBarChart').getContext('2d');
          const salaryBarChart = new Chart(ctx1, {
            type: 'bar',
            data: {
              labels: barChartLabels,  // Years on the x-axis
              datasets: barChartDatasets  // Average salaries by position
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });

          // Prepare data for the Pie Chart (Percentage of Staff by Position)
          const pieChartLabels = Object.keys(positionCount);
          const pieChartData = Object.values(positionCount);

          // Create the Pie Chart for Percentage of Staff by Position
          const ctx2 = document.getElementById('positionPieChart').getContext('2d');
          const positionPieChart = new Chart(ctx2, {
            type: 'pie',
            data: {
              labels: pieChartLabels,
              datasets: [{
                data: pieChartData,
                backgroundColor: pieChartLabels.map(() => getRandomColor())
              }]
            }
          });

          // Prepare data for the Line Chart (Salary Growth Over Time)
          const lineChartDatasets = [];
          for (let position in positionGrowthData) {
            const salaryGrowth = barChartLabels.map(year => {
              return positionGrowthData[position][year] || 0;
            });
            lineChartDatasets.push({
              label: position,
              data: salaryGrowth,
              fill: false,
              borderColor: getRandomColor(),
              tension: 0.1
            });
          }

          // Create the Line Chart for Salary Growth Over Time
          const ctx3 = document.getElementById('salaryGrowthChart').getContext('2d');
          const salaryGrowthChart = new Chart(ctx3, {
            type: 'line',
            data: {
              labels: barChartLabels,  // Years on the x-axis
              datasets: lineChartDatasets  // Salary growth by position
            }
          });

        })
        .catch(error => console.error('Error fetching data:', error));
    });

    // Helper function to generate random colors for charts
    function getRandomColor() {
      const letters = '0123456789ABCDEF';
      let color = '#';
      for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }
  </script>

</body>
</html>
